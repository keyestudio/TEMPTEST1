

# 第5课 超声波测距

![](../../media/9e771e017c2d1924a4e9bcf402b652f1.png)

## （1）项目介绍：

![](../../media/2a0b40b983f1aead31d43e1662c4257e.png)HC-SR04超声波测距模块可提供2cm-400cm的非接触式距离感测功能，测距精度可达高到3mm；模块包括超声波发射器、接收器与控制电路。像智能小车的测距以及转向，或是一些项目中，常常会用到。智能小车测距可以及时发现前方的障碍物，使智能小车可以及时转向，避开障碍物，所以，我们今天就来学习一下这个传感器。


## （2）超声波参数：

电源：+ 5V DC

静态电流：\<2mA

工作电流：15mA

有效角度：\<15°

测距范围：2cm – 400 cm

分辨率：0.3厘米

测量角度：30度

触发输入脉冲宽度：10uS

## （3）项目组件：


|keyes PLUS 开发板*1|Keyes brick L298P 电机驱动扩展板V1*1|keyes 草帽LED白发红模块*1|HC-SR04超声波传感器*1|
|-|-|-|-|
|![](../../media/5ebb5d5ea78becb2b398fcddcdc11367.png)|![](../../media/3dca1bdd1d1420c1d12b16cbf52fee00.png)|![](../../media/31fb938502d3d519813c391569d6a3f3.png)|![](../../media/393e74e8219e2ae066a43f5f19835ea0.png)|
|HX-2.54 4P 双头 连接线*1|3Pin 双母头杜邦线*1|USB线*1|18650双节电池盒*1|18650电池*2 （电池自配）|
|![](../../media/146f0fc8a39a7d767675ff130236d967.png)|![](../../media/07752ebfc8e8af62f1b86c4a725ea284.jpg)|![](../../media/260c62fe8edae84c7a302160a3667ce5.png)|![](../../media/c5bf59a8e5cdded95c02334369ab6fdd.png)|




## （4）超声波模块知识：

原理：看超声波的图可知，像是有两个眼睛，其一边是发射超声的，一边是接收超声波的，然后检测从发射遇到障碍物返回被接收到所需的时间t，再根据声音在空气中的传播速度大概是343m/s,
距离 = 速度 \* 时间 ，
由于超声波发射返回是两段路程了，所以需要除以2，故超声波测到的 距离
=（速度 \* 时间）/2

超声波模块的使用方法及时序图：

1、使用GPIO引脚给SR04的Trig引脚至少10μs的高电平信号，触发SR04模块测距功能；

2、触发后，模块会自动发送8个40KHz的超声波脉冲，并自动检测是否有信号返回。这步会由模块内部自动完成。

3、如有信号返回，Echo引脚会输出高电平，高电平持续的时间就是超声波从发射到返回的时间。

![](../../media/7d2dccb20acaf9b17c53063421a5faa0.png)

超声波模块的电路图

![](../../media/6ba039440b9057fba985c59dfec88033.png)

## （5）接线图：

接线注意：超声波传感器模块的VCC引脚连接至keyestudio V5
传感器扩展板的5v(V)，Trig引脚至数字12(S)，Echo引脚至数字13(S)，Gnd引脚至Gnd(G)。

![](../../media/554eb9b02a2cc5a2c24cd3e745e9eb44.png)

## （6）项目代码：

添加超声波传感器代码块

![](../../media/75f6fdae53ebd5d80ef1b5853557e4b1.png)

在时间栏拖出Arduino启动模块

![](../../media/dec1a5186bbff4fcbc40d7a57b378b72.png)

在串口栏拖出设置串口波特率模块，波特率为9600

![](../../media/3bad923426a89b58da89eddfc09eb905.png)

在控制栏拖出重复执行模块

![](../../media/b1b06138718c3f0961122ad4dd97a9fc.png)

在串口栏拖出串口打印模块，设置不换行；在超声波栏拖出设置超声波模块，设置tirg为12脚，echo为13脚，单位为CM

![](../../media/9e46002364bce76c7bd92134ed509067.png)

在串口栏拖出串口打印模块，设置打印内容为“CM”换行

![](../../media/a7222b4a0ff1765ff406f9811199e6d9.png)

在控制栏拖出延时模块，设置延时为0.25秒

![](../../media/0f5b19741eb2d1ab51a3b7f1da56ee22.png)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*完整的代码如下\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

![](../../media/7832d518e26d3cdfd6474f84dafb542a.png)

注意：超声波需使用扩展板上的外接电源供电

①初始化

②设置串口波特率为9600

③设置变量distance1为整数并赋值0

④设置变量distance2为整数并赋值0

⑤将超声波传感器测量的距离（cm）赋给于变量distance1

⑥变量distance2赋值为变量distance1×0.3937

⑦串口打印变量distance2的值

⑧串口打印字符in,

⑨串口打印变量distance1的值

⑩串口打印字符cm

⑪延时时间为250毫秒

## （7）项目结果：

上传好测试代码到开发板，我们可以看到超声波模块显示的距离，单位是厘米。用手阻挡超声波模块，我们看到显示距离的数值变小了。

![](../../media/475ece10e5176546c64360170f48407f.png)

## （8）项目拓展：

我们刚刚测出了超声波显示的距离，那我们动动脑筋，能不能用测出的距离来做一些控制呢，如果控制一个LED灯的亮和灭。我们来试一下，在D9脚接上一个LED灯模块。

![](../../media/d1ea9f5df7b14adb38271dae7823f3f3.png)

![](../../media/6ae79f62cb7c024822638a9947dd692d.png)

上传好测试代码到开发板，我们用手去靠近超声波传感器，看LED
灯亮起来了没有。



